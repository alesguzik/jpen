<?xml version="1.0"?>
<project name="commonBuild">
	
	<target name="updateNativeBuildProperties" description="update the nativeBuild.properties file">
		<exec executable="bash">
			<arg value="updateNativeBuildProperties.sh"/>
		</exec>
	</target>
	
	<target name="updateBuildProperties" depends="updateNativeBuildProperties" description="update the build.properties file">
		
		<property file="module.properties"/>
		<property file="nativeBuild.properties"/>
		
		<property name="module.commercialId" value="${module.id}"/>
		<tstamp>
			<format property="module.distVersion" pattern="yyMMdd"/>
		</tstamp>
		<property name="module.id-ver" value="${module.id}-${module.version}"/>
		<property name="module.id-fullVer" value="${module.id-ver}-${module.distVersion}"/>
		<property name="module.package-ver" value="${module.package}-${module.version}"/>
		
		<echoproperties destfile="build.properties" regex="(module.*)|(${module.id}.*)"/>
		
		<exec executable="ln" os="Linux">
			<arg value="-sfT"/>
			<arg value="../../../../build.properties"/>
			<arg value="src/main/resources/${module.packageAsDir}/build.properties"/>
		</exec>
	</target>
	
	<target name="readBuildProperties" description="load the build.properties file. Use this task instead of updateBuildProperties when you know that build.properties is up to date. ">
		<fail message="build.properties not found... execute updateBuildProperties">
			<condition>
				<not>
					<available file="build.properties"/>
				</not>
			</condition>
		</fail>
		<property file="build-user.properties"/> <!-- load user properties if needed-->
		<property file="build.properties"/>
	</target>
	
	<target name="updateNativeBuildHeaders" depends="readBuildProperties" description="generate all the native headers using the current build.properties *.nativeBuild properties.">
		<echo file="src/main/c/nativeBuild/linux-BuildNumber.h">
/* DO NOT EDIT THIS FILE - it is machine generated */
#ifndef BuildNumber_h
#define BuildNumber_h
#define BUILD_NUMBER ${jpen.provider.xinput.nativeBuild} 
#endif
</echo>
		<echo file="src/main/c/nativeBuild/windows-BuildNumber.h">
/* DO NOT EDIT THIS FILE - it is machine generated */
#ifndef BuildNumber_h
#define BuildNumber_h
#define BUILD_NUMBER ${jpen.provider.wintab.nativeBuild}
#endif
</echo>
		<echo file="src/main/c/nativeBuild/osx-BuildNumber.h">
/* DO NOT EDIT THIS FILE - it is machine generated */
#ifndef BuildNumber_h
#define BuildNumber_h
#define BUILD_NUMBER ${jpen.provider.osx.nativeBuild}
#endif
</echo>
	</target>
	
</project>